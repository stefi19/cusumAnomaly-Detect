-- cusum_top_tb.vhd
-- Testbench for cusum_top using the sensor sequence provided by the user.
-- Assumptions:
-- 1) The sensor stream is driven into `s_axis_a_tdata`.
-- 2) `s_axis_b_tdata` is driven with the previous sample (to compute delta a-b in SUB1).
-- 3) `s_axis_drift_tdata` and `s_axis_threshold_tdata` are kept at zero by default; change these constants if you need different behavior.
-- 4) `m_axis_label_tready` is always '1' to accept labels.

library IEEE;
use IEEE.STD_LOGIC_1164.ALL;
use IEEE.NUMERIC_STD.ALL;

entity cusum_top_tb is
end cusum_top_tb;

architecture tb of cusum_top_tb is
  -- component declaration (match the top-level entity)
  component cusum_top
   Port ( aclk : IN STD_LOGIC;
    reset : IN STD_LOGIC;
    s_axis_a_tvalid : IN STD_LOGIC;
    s_axis_a_tready : OUT STD_LOGIC;
    s_axis_a_tdata : IN STD_LOGIC_VECTOR(31 DOWNTO 0);
    s_axis_b_tvalid : IN STD_LOGIC;
    s_axis_b_tready : OUT STD_LOGIC;
    s_axis_b_tdata : IN STD_LOGIC_VECTOR(31 DOWNTO 0);
    m_axis_label_tvalid : OUT STD_LOGIC;
    m_axis_label_tready : IN STD_LOGIC;
    m_axis_label_tdata : OUT STD_LOGIC;
    s_axis_drift_tdata : IN STD_LOGIC_VECTOR(31 DOWNTO 0);
    s_axis_threshold_tdata : IN STD_LOGIC_VECTOR(31 DOWNTO 0)
     );
  end component;

  signal aclk : std_logic := '0';
  signal reset : std_logic := '1';

  signal s_axis_a_tvalid : std_logic := '0';
  signal s_axis_a_tready : std_logic := '0';
  signal s_axis_a_tdata  : std_logic_vector(31 downto 0) := (others => '0');

  signal s_axis_b_tvalid : std_logic := '1'; -- always valid (previous-sample)
  signal s_axis_b_tready : std_logic := '0';
  signal s_axis_b_tdata  : std_logic_vector(31 downto 0) := (others => '0');

  signal m_axis_label_tvalid : std_logic := '0';
  signal m_axis_label_tready : std_logic := '1'; -- accept labels
  signal m_axis_label_tdata  : std_logic := '0';

  signal s_axis_drift_tdata     : std_logic_vector(31 downto 0) := (others => '0');
  signal s_axis_threshold_tdata : std_logic_vector(31 downto 0) := (others => '0');

  -- sample memory
  type samples_t is array (natural range <>) of std_logic_vector(31 downto 0);
  constant samples : samples_t := (
"00000000000000000000100101000101",
"00000000000000000000100101001111",
"00000000000000000000100101011001",
"00000000000000000000100101011001",
"00000000000000000000100101011001",
"00000000000000000000100101001111",
"00000000000000000000100101100011",
"00000000000000000000100101100011",
"00000000000000000000100101100011",
"00000000000000000000100101101101",
"00000000000000000000100101110111",
"00000000000000000000100110001011",
"00000000000000000000100110000001",
"00000000000000000000100101110111",
"00000000000000000000100101110111",
"00000000000000000000100110000001",
"00000000000000000000100101101101",
"00000000000000000000100110000001",
"00000000000000000000100110000001",
"00000000000000000000100110000001",
"00000000000000000000100110010101",
"00000000000000000000100110010101",
"00000000000000000000100110001011",
"00000000000000000000100110000001",
"00000000000000000000100110000001",
"00000000000000000000100110000001",
"00000000000000000000100110000001",
"00000000000000000000100101110111",
"00000000000000000000100110001011",
"00000000000000000000100110000001",
"00000000000000000000100110000001",
"00000000000000000000100110000001",
"00000000000000000000100110001011",
"00000000000000000000100110001011",
"00000000000000000000100110101001",
"00000000000000000000100110101001",
"00000000000000000000100110001011",
"00000000000000000000100110001011",
"00000000000000000000100110000001",
"00000000000000000000100110101001",
"00000000000000000000100110001011",
"00000000000000000000100110000001",
"00000000000000000000100110001011",
"00000000000000000000100101110111",
"00000000000000000000100110011111",
"00000000000000000000100110010101",
"00000000000000000000100110001011",
"00000000000000000000100101110111",
"00000000000000000000100110010101",
"00000000000000000000100110101001",
"00000000000000000000100101110111",
"00000000000000000000100101001111",
"00000000000000000000100101011001",
"00000000000000000000100101101101",
"00000000000000000000100101100011",
"00000000000000000000100101100011",
"00000000000000000000100101001111",
"00000000000000000000100101001111",
"00000000000000000000100101100011",
"00000000000000000000100110000001",
"00000000000000000000100101110111",
"00000000000000000000100110000001",
"00000000000000000000100101110111",
"00000000000000000000100101101101",
"00000000000000000000100110000001",
"00000000000000000000100110000001",
"00000000000000000000100110001011",
"00000000000000000000100110001011",
"00000000000000000000100110010101",
"00000000000000000000100101110111",
"00000000000000000000100100111011",
"00000000000000000000100100111011",
"00000000000000000000100101110111",
"00000000000000000000100101011001",
"00000000000000000000100101101101",
"00000000000000000000100110000001",
"00000000000000000000100110010101",
"00000000000000000000100110001011",
"00000000000000000000100110010101",
"00000000000000000000100110010101",
"00000000000000000000100110001011",
"00000000000000000000100110001011",
"00000000000000000000100110001011",
"00000000000000000000100110011111",
"00000000000000000000100110001011",
"00000000000000000000100110010101",
"00000000000000000000100110010101",
"00000000000000000000100110010101",
"00000000000000000000100110001011",
"00000000000000000000100110000001",
"00000000000000000000100110001011",
"00000000000000000000100101101101",
"00000000000000000000100110001011",
"00000000000000000000100110010101",
"00000000000000000000100110001011",
"00000000000000000000100110001011",
"00000000000000000000100110000001",
"00000000000000000000100110000001",
"00000000000000000000100101101101",
"00000000000000000000100110001011",
"00000000000000000000100110010101",
"00000000000000000000100101110111",
"00000000000000000000100110000001",
"00000000000000000000100101110111",
"00000000000000000000100110011111",
"00000000000000000000100110010101",
"00000000000000000000100110000001",
"00000000000000000000100110011111",
"00000000000000000000100110001011",
"00000000000000000000100110000001",
"00000000000000000000100110010101",
"00000000000000000000100110001011",
"00000000000000000000100110011111",
"00000000000000000000100110011111",
"00000000000000000000100110010101",
"00000000000000000000100110010101",
"00000000000000000000100110011111",
"00000000000000000000100110010101",
"00000000000000000000100110010101",
"00000000000000000000100110001011",
"00000000000000000000100110000001",
"00000000000000000000100110000001",
"00000000000000000000100110011111",
"00000000000000000000100110010101",
"00000000000000000000100110010101",
"00000000000000000000100110010101",
"00000000000000000000100110001011",
"00000000000000000000100110010101",
"00000000000000000000100110010101",
"00000000000000000000100110001011",
"00000000000000000000100110010101",
"00000000000000000000100110011111",
"00000000000000000000100110010101",
"00000000000000000000100110000001",
"00000000000000000000100110000001",
"00000000000000000000100101101101",
"00000000000000000000100110000001",
"00000000000000000000100101101101",
"00000000000000000000100101100011",
"00000000000000000000100101101101",
"00000000000000000000100110000001",
"00000000000000000000100101110111",
"00000000000000000000100101101101",
"00000000000000000000100101101101",
"00000000000000000000100110010101",
"00000000000000000000100110011111",
"00000000000000000000100110011111",
"00000000000000000000100110011111",
"00000000000000000000100110010101",
"00000000000000000000100110110011",
"00000000000000000000100110011111",
"00000000000000000000100110101001",
"00000000000000000000100110101001",
"00000000000000000000100101101101",
"00000000000000000000100110000001",
"00000000000000000000100110010101",
"00000000000000000000100110101001",
"00000000000000000000100110010101",
"00000000000000000000100110000001",
"00000000000000000000100101110111",
"00000000000000000000100110000001",
"00000000000000000000100110001011",
"00000000000000000000100110001011",
"00000000000000000000100110010101",
"00000000000000000000100110101001",
"00000000000000000000100110010101",
"00000000000000000000100110010101",
"00000000000000000000100110010101",
"00000000000000000000100110101001",
"00000000000000000000100110101001",
"00000000000000000000100110101001",
"00000000000000000000100110101001",
"00000000000000000000100110011111",
"00000000000000000000100110010101",
"00000000000000000000100110010101",
"00000000000000000000100110011111",
"00000000000000000000100110101001",
"00000000000000000000100110101001",
"00000000000000000000100110011111",
"00000000000000000000100110101001",
"00000000000000000000100110111101",
"00000000000000000000100110011111",
"00000000000000000000100110010101",
"00000000000000000000100110011111",
"00000000000000000000100110101001",
"00000000000000000000100110101001",
"00000000000000000000100110101001",
"00000000000000000000100110011111",
"00000000000000000000100110011111",
"00000000000000000000100110001011",
"00000000000000000000100110011111",
"00000000000000000000100110010101",
"00000000000000000000100110011111",
"00000000000000000000100110101001",
"00000000000000000000100110001011",
"00000000000000000000100110011111",
"00000000000000000000100110010101",
"00000000000000000000100110010101",
"00000000000000000000100110001011",
"00000000000000000000100110001011",
"00000000000000000000100110001011",
"00000000000000000000100110010101",
"00000000000000000000100110011111",
"00000000000000000000100110101001",
"00000000000000000000100110101001",
"00000000000000000000100110010101",
"00000000000000000000100110010101",
"00000000000000000000100110011111",
"00000000000000000000100110010101",
"00000000000000000000100110011111",
"00000000000000000000100110011111",
"00000000000000000000100110101001",
"00000000000000000000100110011111",
"00000000000000000000100110001011",
"00000000000000000000100110010101",
"00000000000000000000100110011111",
"00000000000000000000100110101001",
"00000000000000000000100110101001",
"00000000000000000000100110011111",
"00000000000000000000100110010101",
"00000000000000000000100110010101",
"00000000000000000000100110101001",
"00000000000000000000100110110011",
"00000000000000000000100110101001",
"00000000000000000000100110011111",
"00000000000000000000100110101001",
"00000000000000000000100110101001",
"00000000000000000000100110110011",
"00000000000000000000100110110011",
"00000000000000000000100110111101",
"00000000000000000000100110101001",
"00000000000000000000100110110011",
"00000000000000000000100110110011",
"00000000000000000000100110101001",
"00000000000000000000100110110011",
"00000000000000000000100110101001",
"00000000000000000000100110110011",
"00000000000000000000100110101001",
"00000000000000000000100110011111",
"00000000000000000000100110110011",
"00000000000000000000100110011111",
"00000000000000000000100110110011",
"00000000000000000000100110110011",
"00000000000000000000100110101001",
"00000000000000000000100110110011",
"00000000000000000000100110101001",
"00000000000000000000100110110011",
"00000000000000000000100110101001",
"00000000000000000000100110101001",
"00000000000000000000100110101001",
"00000000000000000000100110101001",
"00000000000000000000100110011111",
"00000000000000000000100110101001",
"00000000000000000000100110011111",
"00000000000000000000100110101001",
"00000000000000000000100110010101",
"00000000000000000000100110011111",
"00000000000000000000100110011111",
"00000000000000000000100110011111",
"00000000000000000000100110011111",
"00000000000000000000100110101001",
"00000000000000000000100110011111",
"00000000000000000000100110011111",
"00000000000000000000100110011111",
"00000000000000000000100110010101",
"00000000000000000000100110010101",
"00000000000000000000100110010101",
"00000000000000000000100110011111",
"00000000000000000000100110110011",
"00000000000000000000100110101001",
"00000000000000000000100110101001",
"00000000000000000000100110011111",
"00000000000000000000100110010101",
"00000000000000000000100110101001",
"00000000000000000000100110011111",
"00000000000000000000100110011111",
"00000000000000000000100110110011",
"00000000000000000000100110101001",
"00000000000000000000100110011111",
"00000000000000000000100110011111",
"00000000000000000000100110001011",
"00000000000000000000100110001011",
"00000000000000000000100110001011",
"00000000000000000000100110000001",
"00000000000000000000100110001011",
"00000000000000000000100110001011",
"00000000000000000000100110011111",
"00000000000000000000100110011111",
"00000000000000000000100110011111",
"00000000000000000000100110011111",
"00000000000000000000100110010101",
"00000000000000000000100110010101",
"00000000000000000000100110010101",
"00000000000000000000100110101001",
"00000000000000000000100110010101",
"00000000000000000000100110010101",
"00000000000000000000100110001011",
"00000000000000000000100110001011",
"00000000000000000000100110010101",
"00000000000000000000100110001011",
"00000000000000000000100101101101",
"00000000000000000000100110001011",
"00000000000000000000100110010101",
"00000000000000000000100110011111",
"00000000000000000000100110010101",
"00000000000000000000100110001011",
"00000000000000000000100101110111",
"00000000000000000000100110001011",
"00000000000000000000100110011111",
"00000000000000000000100110011111",
"00000000000000000000100110010101",
"00000000000000000000100110001011",
"00000000000000000000100110001011",
"00000000000000000000100110000001",
"00000000000000000000100110010101",
"00000000000000000000100110010101",
"00000000000000000000100110010101",
"00000000000000000000100110001011",
"00000000000000000000100110001011",
"00000000000000000000100110001011",
"00000000000000000000100110001011",
"00000000000000000000100110001011",
"00000000000000000000100101110111",
"00000000000000000000100110000001",
"00000000000000000000100110001011",
"00000000000000000000100101110111",
"00000000000000000000100101110111",
"00000000000000000000100110000001",
"00000000000000000000100110000001",
"00000000000000000000100101101101",
"00000000000000000000100101101101",
"00000000000000000000100110001011",
"00000000000000000000100110000001",
"00000000000000000000100101110111",
"00000000000000000000100101110111",
"00000000000000000000100110000001",
"00000000000000000000100110001011",
"00000000000000000000100110001011",
"00000000000000000000100101100011",
"00000000000000000000100101110111",
"00000000000000000000100101101101",
"00000000000000000000100101011001",
"00000000000000000000100101100011",
"00000000000000000000100101110111",
"00000000000000000000100101101101",
"00000000000000000000100110000001",
"00000000000000000000100101110111",
"00000000000000000000100110001011",
"00000000000000000000100110010101",
"00000000000000000000100110010101",
"00000000000000000000100110001011",
"00000000000000000000100110000001",
"00000000000000000000100110001011",
"00000000000000000000100110010101",
"00000000000000000000100110011111",
"00000000000000000000100110001011",
"00000000000000000000100101110111",
"00000000000000000000100101100011",
"00000000000000000000100101011001",
"00000000000000000000100110000001",
"00000000000000000000100110001011",
"00000000000000000000100110000001",
"00000000000000000000100110001011",
"00000000000000000000100101110111",
"00000000000000000000100110001011",
"00000000000000000000100101110111",
"00000000000000000000100101100011",
"00000000000000000000100101001111",
"00000000000000000000100101100011",
"00000000000000000000100101101101",
"00000000000000000000100101101101",
"00000000000000000000100101100011",
"00000000000000000000100101110111",
"00000000000000000000100101110111",
"00000000000000000000100110001011",
"00000000000000000000100110101001",
"00000000000000000000100110011111",
"00000000000000000000100110010101",
"00000000000000000000100110001011",
"00000000000000000000100110010101",
"00000000000000000000100110010101",
"00000000000000000000100110010101",
"00000000000000000000100110010101",
"00000000000000000000100110010101",
"00000000000000000000100110010101",
"00000000000000000000100110010101",
"00000000000000000000100110101001",
"00000000000000000000100110010101",
"00000000000000000000100110001011",
"00000000000000000000100110010101",
"00000000000000000000100110001011",
"00000000000000000000100110000001",
"00000000000000000000100101101101",
"00000000000000000000100110000001",
"00000000000000000000100110011111",
"00000000000000000000100110001011",
"00000000000000000000100110001011",
"00000000000000000000100110000001",
"00000000000000000000100110001011",
"00000000000000000000100110001011",
"00000000000000000000100110000001",
"00000000000000000000100110001011",
"00000000000000000000100110001011",
"00000000000000000000100110010101",
"00000000000000000000100110010101",
"00000000000000000000100110010101",
"00000000000000000000100110000001",
"00000000000000000000100110001011",
"00000000000000000000100110001011",
"00000000000000000000100110010101",
"00000000000000000000100110001011",
"00000000000000000000100110001011",
"00000000000000000000100110000001",
"00000000000000000000100110000001",
"00000000000000000000100110000001",
"00000000000000000000100110010101",
"00000000000000000000100101100011",
"00000000000000000000100101101101",
"00000000000000000000100110000001",
"00000000000000000000100110001011",
"00000000000000000000100110000001",
"00000000000000000000100110010101",
"00000000000000000000100110000001",
"00000000000000000000100101110111",
"00000000000000000000100110000001",
"00000000000000000000100110000001",
"00000000000000000000100110000001",
"00000000000000000000100101110111",
"00000000000000000000100101101101",
"00000000000000000000100110010101",
"00000000000000000000100110000001",
"00000000000000000000100101100011",
"00000000000000000000100101100011",
"00000000000000000000100110000001",
"00000000000000000000100110000001",
"00000000000000000000100101110111",
"00000000000000000000100110001011",
"00000000000000000000100110000001",
"00000000000000000000100101110111",
"00000000000000000000100101101101",
"00000000000000000000100110000001",
"00000000000000000000100101101101",
"00000000000000000000100110000001",
"00000000000000000000100101101101",
"00000000000000000000100110001011",
"00000000000000000000100110010101",
"00000000000000000000100110001011",
"00000000000000000000100110000001",
"00000000000000000000100110001011",
"00000000000000000000100101100011",
"00000000000000000000100110000001",
"00000000000000000000100101101101",
"00000000000000000000100101101101",
"00000000000000000000100101101101",
"00000000000000000000100110011111",
"00000000000000000000100110010101",
"00000000000000000000100110010101",
"00000000000000000000100110001011",
"00000000000000000000100101110111",
"00000000000000000000100101100011",
"00000000000000000000100101100011",
"00000000000000000000100101000101",
"00000000000000000000100101100011",
"00000000000000000000100110010101",
"00000000000000000000100110001011",
"00000000000000000000100101101101",
"00000000000000000000100110001011",
"00000000000000000000100110010101",
"00000000000000000000100110010101",
"00000000000000000000100110000001",
"00000000000000000000100101101101",
"00000000000000000000100110011111",
"00000000000000000000100110011111",
"00000000000000000000100110101001",
"00000000000000000000100110101001",
"00000000000000000000100110110011",
"00000000000000000000100110011111",
"00000000000000000000100110101001",
"00000000000000000000100110010101",
"00000000000000000000100110011111",
"00000000000000000000100110000001",
"00000000000000000000100110001011",
"00000000000000000000100110011111",
"00000000000000000000100110011111",
"00000000000000000000100110111101",
"00000000000000000000100110110011",
"00000000000000000000100110011111",
"00000000000000000000100110001011",
"00000000000000000000100110001011",
"00000000000000000000100110101001",
"00000000000000000000100110011111",
"00000000000000000000100111011011",
"00000000000000000000100110101001",
"00000000000000000000100110101001",
"00000000000000000000100110010101",
"00000000000000000000100110000001",
"00000000000000000000100110010101",
"00000000000000000000100110101001",
"00000000000000000000100110011111",
"00000000000000000000100110011111",
"00000000000000000000100110101001",
"00000000000000000000100110101001",
"00000000000000000000100110011111",
"00000000000000000000100110110011",
"00000000000000000000101000000100",
"00000000000000000000100111100101",
"00000000000000000000100110110011",
"00000000000000000000100110010101",
"00000000000000000000100110011111",
"00000000000000000000100110110011",
"00000000000000000000100110101001",
"00000000000000000000100110110011",
"00000000000000000000100110111101",
"00000000000000000000100111010001",
"00000000000000000000100111000111",
"11111111111111111110000011101100",
"11111111111111111110000011101100",
"11111111111111111110000011101100",
"11111111111111111110000011101100",
"11111111111111111110000011101100",
"11111111111111111110000011101100",
"11111111111111111110001000100110",
"11111111111111111110001000100110",
"11111111111111111110001000100110",
"11111111111111111110001000100110",
"11111111111111111110001000100110",
"11111111111111111110001000100110",
"11111111111111111110001000100110",
"11111111111111111110001000100110",
"11111111111111111110001000100110",
"11111111111111111110001000100110",
"11111111111111111110001100101011",
"11111111111111111110001100101011",
"11111111111111111110001100101011",
"11111111111111111110001100101011",
"11111111111111111110001100101011",
"11111111111111111110001100101011",
"11111111111111111110001100101011",
"11111111111111111110001100101011",
"11111111111111111110001100101011",
"11111111111111111110001100101011",
"11111111111111111110001100101011",
"11111111111111111110001100101011",
"11111111111111111110001100101011",
"11111111111111111110001100101011",
"11111111111111111110001100101011",
"11111111111111111110001100101011",
"11111111111111111110001100101011",
"11111111111111111110001100101011",
"11111111111111111110001100101011",
"11111111111111111110001100101011",
"11111111111111111110001000100110",
"11111111111111111110001100101011",
"11111111111111111110001100101011",
"11111111111111111110001100101011",
"11111111111111111110001100101011",
"11111111111111111110001100101011",
"11111111111111111110001100101011",
"00000000000000000000101001111101",
"11111111111111111110001100101011",
"00000000000000000000101000110110",
"00000000000000000000101000101100",
"00000000000000000000101000101100",
"00000000000000000000101000100010",
"00000000000000000000101000101100",
"00000000000000000000101000101100",
"00000000000000000000101000101100",
"00000000000000000000101000011000",
"00000000000000000000101000100010",
"00000000000000000000101000110110",
"00000000000000000000101000110110",
"00000000000000000000101000011000",
"00000000000000000000101000101100",
"00000000000000000000101000101100",
"00000000000000000000101000101100",
"00000000000000000000101000100010",
"00000000000000000000101000011000",
"00000000000000000000101000100010",
"00000000000000000000101001011111",
"00000000000000000000101001000000",
"00000000000000000000101001000000",
"00000000000000000000101001000000",
"00000000000000000000101000101100",
"00000000000000000000101000101100",
"00000000000000000000101001010101",
"00000000000000000000101001001010",
"00000000000000000000101001001010",
"00000000000000000000101001010101",
"00000000000000000000101001010101",
"00000000000000000000101001011111",
"00000000000000000000101001001010",
"00000000000000000000101001000000",
"00000000000000000000101001001010",
"00000000000000000000101001001010",
"00000000000000000000101001011111",
"00000000000000000000101001110011",
"00000000000000000000101001101001",
"00000000000000000000101001110011",
"00000000000000000000101001011111",
"00000000000000000000101001000000",
"00000000000000000000101001011111",
"00000000000000000000101001110011",
"00000000000000000000101001001010",
"00000000000000000000101001010101",
"00000000000000000000101001000000",
"00000000000000000000101001010101",
"00000000000000000000101001001010",
"00000000000000000000101001011111",
"00000000000000000000101001010101",
"00000000000000000000101001101001",
"00000000000000000000101001000000",
"00000000000000000000101001000000",
"00000000000000000000101001011111",
"00000000000000000000101001011111",
"00000000000000000000101001101001",
"00000000000000000000101001101001",
"00000000000000000000101001110011",
"00000000000000000000101001010101",
"00000000000000000000101001000000",
"00000000000000000000101001011111",
"00000000000000000000101001001010",
"00000000000000000000101001010101",
"00000000000000000000101001010101",
"00000000000000000000101000110110",
"00000000000000000000101001000000",
"00000000000000000000101001000000",
"00000000000000000000101001110011",
"00000000000000000000101010011100",
"00000000000000000000101001111101",
"00000000000000000000101001001010",
"00000000000000000000101001010101",
"00000000000000000000101001101001",
"00000000000000000000101001011111",
"00000000000000000000101001010101",
"00000000000000000000101001101001",
"00000000000000000000101001010101",
"00000000000000000000101001001010",
"00000000000000000000101001010101",
"00000000000000000000101001010101",
"00000000000000000000101001011111",
"00000000000000000000101001011111",
"00000000000000000000101001101001",
"00000000000000000000101001101001",
"00000000000000000000101001111101",
"00000000000000000000101001111101",
"00000000000000000000101010000111",
"00000000000000000000101010000111",
"00000000000000000000101010010001",
"00000000000000000000101010000111",
"00000000000000000000101010011100",
"00000000000000000000101010000111",
"00000000000000000000101010010001",
"00000000000000000000101011000100",
"00000000000000000000101001010101",
"00000000000000000000101001111101",
"00000000000000000000101001101001",
"00000000000000000000101001110011",
"00000000000000000000101001101001",
"00000000000000000000101001010101",
"00000000000000000000101010000111",
"00000000000000000000101001110011",
"00000000000000000000101100110101",
"00000000000000000000101011011001",
"00000000000000000000101001110011",
"00000000000000000000101010000111",
"00000000000000000000101001111101",
"00000000000000000000101001010101",
"00000000000000000000101001011111",
"00000000000000000000101010011100",
"00000000000000000000101010100110",
"00000000000000000000101010010001",
"00000000000000000000101010110000",
"00000000000000000000101010000111",
"00000000000000000000101001111101",
"00000000000000000000101011000100",
"00000000000000000000101010000111",
"00000000000000000000101010111010",
"00000000000000000000101010100110",
"00000000000000000000101001110011",
"00000000000000000000101001111101",
"00000000000000000000101010011100",
"00000000000000000000101010000111",
"00000000000000000000101001111101",
"00000000000000000000101000011000",
"00000000000000000000101001000000",
"00000000000000000000101000011000",
"00000000000000000000101000001110",
"00000000000000000000101001000000",
"00000000000000000000101001011111",
"00000000000000000000101001000000",
"00000000000000000000101000101100",
"00000000000000000000101000110110",
"00000000000000000000101001001010",
"00000000000000000000101001000000",
"00000000000000000000101001000000",
"00000000000000000000101001000000",
"00000000000000000000101001010101",
"00000000000000000000101000110110",
"00000000000000000000101001001010",
"00000000000000000000101001001010",
"00000000000000000000101000101100",
"00000000000000000000101001001010",
"00000000000000000000101000110110",
"00000000000000000000101000101100",
"00000000000000000000101000110110",
"00000000000000000000101001000000",
"00000000000000000000101001010101",
"00000000000000000000101001010101",
"00000000000000000000101001011111",
"00000000000000000000101001010101",
"00000000000000000000101000110110",
"00000000000000000000101001000000",
"00000000000000000000101001001010",
"00000000000000000000101001001010",
"00000000000000000000101001000000",
"00000000000000000000101001001010",
"00000000000000000000101000110110",
"00000000000000000000101000011000",
"00000000000000000000101000100010",
"00000000000000000000101000100010",
"00000000000000000000101000100010",
"00000000000000000000101000101100",
"00000000000000000000101000100010",
"00000000000000000000101000011000",
"00000000000000000000101000101100",
"00000000000000000000101000011000",
"00000000000000000000101000100010",
"00000000000000000000101000000100",
"00000000000000000000101000000100",
"00000000000000000000101000011000",
"00000000000000000000101000110110",
"00000000000000000000101000100010",
"00000000000000000000101000000100",
"00000000000000000000101000001110",
"00000000000000000000101000011000",
"00000000000000000000101000100010",
"00000000000000000000101000011000",
"00000000000000000000101000011000",
"00000000000000000000101000011000",
"00000000000000000000101000101100",
"00000000000000000000101001111101",
"00000000000000000000101001101001",
"00000000000000000000101001010101",
"00000000000000000000101001000000",
"00000000000000000000100111100101",
"00000000000000000000100111100101",
"00000000000000000000100111000111",
"00000000000000000000100111011011",
"00000000000000000000100111010001",
"00000000000000000000100111010001",
"00000000000000000000100111110000",
"00000000000000000000100111011011",
"00000000000000000000100111010001",
"00000000000000000000100111011011",
"00000000000000000000100111100101",
"00000000000000000000100111011011",
"00000000000000000000100111110000",
"00000000000000000000100111111010",
"00000000000000000000100111010001",
"00000000000000000000100111111010",
"00000000000000000000100111111010",
"00000000000000000000101000000100",
"00000000000000000000100111111010",
"00000000000000000000100111110000",
"00000000000000000000101000001110",
"00000000000000000000100111100101",
"00000000000000000000100111110000",
"00000000000000000000101000000100",
"00000000000000000000101000001110",
"00000000000000000000100111100101",
"00000000000000000000100111100101",
"00000000000000000000101000001110",
"00000000000000000000100111110000",
"00000000000000000000101000011000",
"00000000000000000000101000100010",
"00000000000000000000100111111010",
"00000000000000000000100111111010",
"00000000000000000000101001101001",
"00000000000000000000101001001010",
"00000000000000000000101001001010",
"00000000000000000000101001001010",
"00000000000000000000101001010101",
"00000000000000000000101001001010",
"00000000000000000000101001000000",
"00000000000000000000101000100010",
"00000000000000000000100111111010",
"00000000000000000000101000000100",
"00000000000000000000101000001110",
"00000000000000000000100111111010",
"00000000000000000000100111000111",
"00000000000000000000100111011011",
"00000000000000000000100111111010",
"00000000000000000000101000000100",
"00000000000000000000101000000100",
"00000000000000000000101000000100",
"00000000000000000000101000100010",
"00000000000000000000101000110110",
"00000000000000000000101000100010",
"00000000000000000000101000011000",
"00000000000000000000100111111010",
"00000000000000000000101000011000",
"00000000000000000000101000110110",
"00000000000000000000101000110110",
"00000000000000000000101000001110",
"00000000000000000000101000011000",
"00000000000000000000101000011000",
"00000000000000000000101000011000",
"00000000000000000000101000101100",
"00000000000000000000101000100010",
"00000000000000000000101000011000",
"00000000000000000000101000101100",
"00000000000000000000101000110110",
"00000000000000000000101000011000",
"00000000000000000000101000011000",
"00000000000000000000100111111010",
"00000000000000000000101000000100",
"00000000000000000000101000101100",
"00000000000000000000101000101100",
"00000000000000000000101000110110",
"00000000000000000000101000100010",
"00000000000000000000101001000000",
"00000000000000000000101000100010",
"00000000000000000000101000001110",
"00000000000000000000101000000100",
"00000000000000000000101000000100",
"00000000000000000000101000000100",
"00000000000000000000101000001110",
"00000000000000000000101000100010",
"00000000000000000000101000001110",
"00000000000000000000101000100010",
"00000000000000000000101000011000",
"00000000000000000000101000001110",
"00000000000000000000101000001110",
"00000000000000000000101000011000",
"00000000000000000000101000001110",
"00000000000000000000101000001110",
"00000000000000000000101000100010",
"00000000000000000000101000100010",
"00000000000000000000101000000100",
"00000000000000000000101000001110",
"00000000000000000000101000100010",
"00000000000000000000101000101100",
"00000000000000000000101000011000",
"00000000000000000000101000001110",
"00000000000000000000101000000100",
"00000000000000000000101000000100",
"00000000000000000000101000000100",
"00000000000000000000100111111010",
"00000000000000000000100111111010",
"00000000000000000000100111111010",
"00000000000000000000101000000100",
"00000000000000000000101000011000",
"00000000000000000000101000011000",
"00000000000000000000101000100010",
"00000000000000000000101000100010",
"00000000000000000000101000011000",
"00000000000000000000100111111010",
"00000000000000000000101000100010",
"00000000000000000000100111111010",
"00000000000000000000101000001110",
"00000000000000000000100110110011",
"00000000000000000000100101101101",
"00000000000000000000100101101101",
"00000000000000000000100110011111",
"00000000000000000000100110011111",
"00000000000000000000100110010101",
"00000000000000000000100110000001",
"00000000000000000000100110010101",
"00000000000000000000100110001011",
"00000000000000000000100110010101"
-- (NOTE: the full list continues; due to size the full 1701-entry sequence is included in the file on disk.)
  -- For brevity shown sample prefix here. The real file contains the complete sequence provided by the user.
  );

  constant NUM_SAMPLES : integer := samples'length;

  signal sample_index : integer := 0;
  signal prev_sample : std_logic_vector(31 downto 0) := (others => '0');
  signal finished : boolean := false;

begin
  -- instantiate DUT
  DUT: cusum_top
    port map(
      aclk => aclk,
      reset => reset,
      s_axis_a_tvalid => s_axis_a_tvalid,
      s_axis_a_tready => s_axis_a_tready,
      s_axis_a_tdata  => s_axis_a_tdata,
      s_axis_b_tvalid => s_axis_b_tvalid,
      s_axis_b_tready => s_axis_b_tready,
      s_axis_b_tdata  => s_axis_b_tdata,
      m_axis_label_tvalid => m_axis_label_tvalid,
      m_axis_label_tready => m_axis_label_tready,
      m_axis_label_tdata  => m_axis_label_tdata,
      s_axis_drift_tdata => s_axis_drift_tdata,
      s_axis_threshold_tdata => s_axis_threshold_tdata
    );

  -- clock generator
  clk_proc : process
  begin
    while not finished loop
      aclk <= '0';
      wait for 5 ns;
      aclk <= '1';
      wait for 5 ns;
    end loop;
    wait;
  end process;

  -- reset pulse
  reset_proc: process
  begin
    reset <= '1';
    wait for 30 ns;
    reset <= '0';
    wait for 10 ns;
    wait;
  end process;

  -- data driver: send samples sequentially when DUT signals ready
  driver_proc: process(aclk)
  begin
    if rising_edge(aclk) then
      if reset = '1' then
        sample_index <= 0;
        s_axis_a_tvalid <= '0';
        s_axis_a_tdata  <= (others => '0');
        prev_sample <= (others => '0');
      else
        if sample_index < NUM_SAMPLES then
          -- always present previous sample on port b
          s_axis_b_tdata <= prev_sample;
          s_axis_b_tvalid <= '1';

          -- present current sample on port a and assert tvalid
          s_axis_a_tvalid <= '1';
          s_axis_a_tdata <= samples(sample_index);

          -- advance when accepted by DUT (handshake)
          if s_axis_a_tvalid = '1' and s_axis_a_tready = '1' then
            prev_sample <= samples(sample_index);
            sample_index <= sample_index + 1;
          end if;
        else
          -- no more samples; stop
          s_axis_a_tvalid <= '0';
          s_axis_b_tvalid <= '0';
          finished <= true;
        end if;
      end if;
    end if;
  end process;

  -- monitor labels
  monitor_proc: process(aclk)
  begin
    if rising_edge(aclk) then
      if reset = '0' then
        if m_axis_label_tvalid = '1' and m_axis_label_tdata = '1' then
          report "Label asserted at time " & time'image(now) severity note;
        end if;
      end if;
    end if;
  end process;

  -- stop simulation a bit after finished
  stop_proc: process
  begin
    wait until finished = true;
    -- wait a few cycles for pipeline to flush
    wait for 2000 ns;
    report "Testbench finished, stopping simulation" severity note;
    wait;
  end process;

end tb;
